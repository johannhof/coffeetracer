(function(){var e;(e=jQuery)(function(){var a,r,t,n,l,i,o,c,s,p,d,h,u,v,g,m,f,F,w,x,b,I,M,C,L,R,T,k,P,E,S,_,A,D,y,X,Y,Z,B,H,O,W,N,j,z,U,V,J;return e("#loadDiv").toggle(),w=e("#nodeHTMLExample").html(),Y=e("#sphereHTMLExample").html(),r=e("#boxHTMLExample").html(),S=e("#planeHTMLExample").html(),W=e("#triangleHTMLExample").html(),X=e("#SingleColorMaterialHTMLExample").html(),F=e("#LambertMaterialHTMLExample").html(),E=e("#PhongMaterialHTMLExample").html(),A=e("#ReflectiveMaterialHTMLExample").html(),O=e("#TransparentMaterialHTMLExample").html(),y=e("#ScalingHTMLExample").html(),H=e("#TranslationHTMLExample").html(),U=e("#X-RotationHTMLExample").html(),V=e("#Y-RotationHTMLExample").html(),J=e("#Z-RotationHTMLExample").html(),e("#addObjectButton").click(function(){return e("#objects").append(v(e("#selectObject").val()))}),v=function(e,a){switch(null==a&&(a=!1),e){case"Node":return i;case"Sphere":return o("sphere",Y,a);case"Box":return o("box",r,a);case"Plane":return o("plane",S,a);case"Triangle":return o("triangle",W,a);default:return e+"not valid"}},a=function(a){return e(a).children(".removeButton").click(function(){return e(a).remove()})},o=function(r,t,n){var l;return l=document.createElement("div"),l.setAttribute("class",r),e(l).css("border","1px solid lightgrey").css("margin-bottom","5px").css("padding","10px").append(e("#objectHTMLExample").html()),e(l).children("b").html(r+":"),n||e(l).append(t),a(l),e(l).children(".selectMaterial").change(function(){return e(l).children(".materialContainer").html(u(this.value))}),l},l=function(r,t){var n;return n=document.createElement("div"),n.setAttribute("class",r),e(n).css("border","1px solid lightgrey").css("margin-bottom","5px").css("padding","10px").append(t),a(n),n},i=function(){var r;return r=document.createElement("div"),r.setAttribute("class","node"),e(r).css("border","1px solid lightgrey").css("margin-bottom","5px").css("padding","10px").append(w),a(r),e(r).children(".input-append").children(".addNodeObject").click(function(){return e(r).children(".nodeContainer").append(v(e(r).children(".input-append").children(".nodeSelectObject").val(),!0))}),e(r).children(".input-append").children(".addTransformation").click(function(){return e(r).children(".transformationContainer").append(g(e(r).children(".input-append").children(".nodeSelectTransformation").val()))}),r},c=function(r,t){var n;return n=document.createElement("div"),n.setAttribute("class",r),e(n).append(t),a(n),n},g=function(e){switch(e){case"Scaling":return c("scaling",y);case"Translation":return c("translation",H);case"X-Rotation":return c("xRotation",U);case"Y-Rotation":return c("yRotation",V);case"Z-Rotation":return c("zRotation",J);default:return null}},u=function(e){switch(e){case"SingleColorMaterial":return X;case"LambertMaterial":return F;case"PhongMaterial":return E;case"ReflectiveMaterial":return A;case"TransparentMaterial":return O;default:return null}},_=e("#pointLightExample").html(),Z=e("#spotLightExample").html(),p=e("#directionalLightExample").html(),e("#addLightButton").click(function(){return e("#lightsDiv").append(h(e("#selectLight").val()))}),h=function(e){switch(e){case"PointLight":return l("pointLight",_);case"SpotLight":return l("spotLight",Z);case"DirectionalLight":return l("directionalLight",p);default:return e+"not valid"}},e("#selectCamera").change(function(){return"PerspectiveCamera"===this.value?e("#cameraSpec").html('<label for="camera_alpha">alpha = PI / </label><input type="text" id="camera_alpha" value="4" size="2">'):"OrthographicCamera"===this.value?e("#cameraSpec").html('<label for="camera_s">s = </label><input type="text" id="camera_s" value="5" size="2">'):alert("Fail")}),I=function(){var a,r,t,n;return r=new Point3(parseFloat(e("#camera_e_x").val()),parseFloat(e("#camera_e_y").val()),parseFloat(e("#camera_e_z").val())),t=new Vector3(parseFloat(e("#camera_g_x").val()),parseFloat(e("#camera_g_y").val()),parseFloat(e("#camera_g_z").val())),n=new Vector3(parseFloat(e("#camera_t_x").val()),parseFloat(e("#camera_t_y").val()),parseFloat(e("#camera_t_z").val())),a=e("#cameraSpec input")[0].value,"PerspectiveCamera"===e("#selectCamera")[0].value?new PerspectiveCamera(r,t,n,Math.PI/a):"OrthographicCamera"===e("#selectCamera")[0].value?new OrthographicCamera(r,t,n,a):void 0},n=document.getElementById("mainCanvas"),s=n.getContext("2d"),s.fillStyle="white",N=n.width,m=n.height,s.fillRect(0,0,N,m),f=s.getImageData(0,0,N,m),e("#resizeCanvasButton").click(function(){return n.width=parseFloat(e("#widthInput").val()),n.height=parseFloat(e("#heightInput").val()),s=n.getContext("2d"),s.fillStyle="white",N=n.width,m=n.height,s.fillRect(0,0,N,m),f=s.getImageData(0,0,N,m)}),B=0,t=null,z=null,x=function(){var a;return a=e("#ambientLight"),new Color(parseFloat(e(a).children(".redInput").val()),parseFloat(e(a).children(".greenInput").val()),parseFloat(e(a).children(".blueInput").val()))},k=function(a){var r,t,n,l;for(null==a&&(a=e("#objects").children("div")),l=[],t=0,n=a.length;n>t;t++)r=a[t],l.push(T(r));return l},T=function(a){var r,t,n,l,i,o,c,s,p,d;if(c=e(a).attr("class"),i=R(a),s=e(a).children(".objectContainer")[0])switch(c){case"plane":return r=new Point3(parseFloat(e(s).children(".planeAX").val()),parseFloat(e(s).children(".planeAY").val()),parseFloat(e(s).children(".planeAZ").val())),o=new Normal3(parseFloat(e(s).children(".planeNX").val()),parseFloat(e(s).children(".planeNY").val()),parseFloat(e(s).children(".planeNZ").val())),new Plane(i,r,o);case"box":return l=new Point3(parseFloat(e(s).children(".boxLBFX").val()),parseFloat(e(s).children(".boxLBFY").val()),parseFloat(e(s).children(".boxLBFZ").val())),d=new Point3(parseFloat(e(s).children(".boxRUNX").val()),parseFloat(e(s).children(".boxRUNY").val()),parseFloat(e(s).children(".boxRUNZ").val())),new AxisAlignedBox(i,l,d);case"sphere":return n=new Point3(parseFloat(e(s).children(".sphereCenterX").val()),parseFloat(e(s).children(".sphereCenterY").val()),parseFloat(e(s).children(".sphereCenterZ").val())),p=parseFloat(e(s).children(".sphereRadius").val()),new Sphere(i,n,p);case"triangle":return r=new Point3(parseFloat(e(s).children(".triangleAX").val()),parseFloat(e(s).children(".triangleAY").val()),parseFloat(e(s).children(".triangleAZ").val())),t=new Point3(parseFloat(e(s).children(".triangleBX").val()),parseFloat(e(s).children(".triangleBY").val()),parseFloat(e(s).children(".triangleBZ").val())),n=new Point3(parseFloat(e(s).children(".triangleCX").val()),parseFloat(e(s).children(".triangleCY").val()),parseFloat(e(s).children(".triangleCZ").val())),new Triangle(i,r,t,n);default:return null}else switch(c){case"plane":return new Plane(i);case"box":return new AxisAlignedBox(i);case"sphere":return new Sphere(i);case"triangle":return new Triangle(i);case"node":return new Node(P(e(a).children(".transformationContainer")),k(e(a).children(".nodeContainer").children("div")));default:return null}},R=function(a){var r,t;switch(r=e(a).children(".selectMaterial").val(),t=e(a).children(".materialContainer"),r){case"SingleColorMaterial":return new SingleColorMaterial(new Color(parseFloat(e(t).children(".redInput").val()),parseFloat(e(t).children(".greenInput").val()),parseFloat(e(t).children(".blueInput").val())));case"LambertMaterial":return new LambertMaterial(new Color(parseFloat(e(t).children(".redInput").val()),parseFloat(e(t).children(".greenInput").val()),parseFloat(e(t).children(".blueInput").val())));case"PhongMaterial":return new PhongMaterial(new Color(parseFloat(e(t).children(".diffuse.redInput").val()),parseFloat(e(t).children(".diffuse.greenInput").val()),parseFloat(e(t).children(".diffuse.blueInput").val())),new Color(parseFloat(e(t).children(".specular.redInput").val()),parseFloat(e(t).children(".specular.greenInput").val()),parseFloat(e(t).children(".specular.blueInput").val())),parseFloat(e(t).children(".exponent").val()));case"ReflectiveMaterial":return new ReflectiveMaterial(new Color(parseFloat(e(t).children(".diffuse.redInput").val()),parseFloat(e(t).children(".diffuse.greenInput").val()),parseFloat(e(t).children(".diffuse.blueInput").val())),new Color(parseFloat(e(t).children(".specular.redInput").val()),parseFloat(e(t).children(".specular.greenInput").val()),parseFloat(e(t).children(".specular.blueInput").val())),parseFloat(e(t).children(".exponent").val()),new Color(parseFloat(e(t).children(".reflection.redInput").val()),parseFloat(e(t).children(".reflection.greenInput").val()),parseFloat(e(t).children(".reflection.blueInput").val())));case"TransparentMaterial":return new TransparentMaterial(parseFloat(e(t).children(".indexOfRefraction").val()));default:return null}},P=function(a){var r,t,n,l,i,o;for(r=e(a).children("div")[0],t=function(){switch(e(r).attr("class")){case"scaling":return Transform.Scaling(parseFloat(e(r).children(".scalingX").val()),parseFloat(e(r).children(".scalingY").val()),parseFloat(e(r).children(".scalingZ").val()));case"translation":return Transform.Translation(parseFloat(e(r).children(".translationX").val()),parseFloat(e(r).children(".translationY").val()),parseFloat(e(r).children(".translationZ").val()));case"xRotation":return Transform.XRotation(parseFloat(e(r).children(".rotationAngle").val())/180*Math.PI);case"yRotation":return Transform.YRotation(parseFloat(e(r).children(".rotationAngle").val())/180*Math.PI);case"zRotation":return Transform.ZRotation(parseFloat(e(r).children(".rotationAngle").val())/180*Math.PI);default:return Transform.Scaling(1,1,1)}}(),l=e(a).children("div").slice(1),i=0,o=l.length;o>i;i++)n=l[i],t=function(){switch(e(n).attr("class")){case"scaling":return t.scale(parseFloat(e(n).children(".scalingX").val()),parseFloat(e(n).children(".scalingY").val()),parseFloat(e(n).children(".scalingZ").val()));case"translation":return t.translate(parseFloat(e(n).children(".translationX").val()),parseFloat(e(n).children(".translationY").val()),parseFloat(e(n).children(".translationZ").val()));case"xRotation":return t.xRotate(parseFloat(e(n).children(".rotationAngle").val())/180*Math.PI);case"yRotation":return t.yRotate(parseFloat(e(n).children(".rotationAngle").val())/180*Math.PI);case"zRotation":return t.zRotate(parseFloat(e(n).children(".rotationAngle").val())/180*Math.PI);default:return t}}();return t},b=function(){var a;return a=e("#worldDiv"),new Color(parseFloat(e(a).children(".redInput").val()),parseFloat(e(a).children(".greenInput").val()),parseFloat(e(a).children(".blueInput").val()))},L=function(){var a,r,t,n,l;for(r=e("#lightsDiv").children("div"),l=[],t=0,n=r.length;n>t;t++)a=r[t],e(a).children(".lightCheck").is(":checked")&&l.push(C(a));return l},C=function(a){var r,t,n,l,i;return n=e(a).attr("class"),r=new Color(parseFloat(e(a).children(".redInput").val()),parseFloat(e(a).children(".greenInput").val()),parseFloat(e(a).children(".blueInput").val())),i=e(a).children(".shadowCheck").is(":checked"),l=new Point3(parseFloat(e(a).children(".posX").val()),parseFloat(e(a).children(".posY").val()),parseFloat(e(a).children(".posZ").val())),"pointLight"===n?new PointLight(r,i,l):(t=new Vector3(parseFloat(e(a).children(".dirX").val()),parseFloat(e(a).children(".dirY").val()),parseFloat(e(a).children(".dirZ").val())),"directionalLight"===n?new DirectionalLight(r,i,t):new SpotLight(r,i,l,t,Math.PI/parseFloat(e(a).children(".halfAngle").val())))},M=function(){return t=I(),z=new World(b(),k(),L(),x(),parseFloat(e("#worldDiv").children(".indexOfRefraction").val()))},j={workers:[],numberOfFinishedWorkers:0,startWorker:function(a,r){var n,l;return l=N/r*a,n=l+N/r,this.workers[a]=new Worker("build/engine.js"),this.workers[a].addEventListener("message",function(a){return d(a.data.imgData,l,0,n,m),r===++j.numberOfFinishedWorkers?(s.putImageData(f,0,0),e("#loadDiv").toggle(),e("#timeDiv").html("Rendered with "+j.numberOfFinishedWorkers+" workers in "+(Date.now()-B)/1e3+" Seconds")):void 0},!1),this.workers[a].postMessage(JSON.stringify({startW:l,endW:n,width:N,height:m,cam:t,world:z}))},startWorkers:function(e){var a,r,t;for(j.numberOfFinishedWorkers=0,a=r=0,t=e-1;t>=0?t>=r:r>=t;a=t>=0?++r:--r)this.startWorker(a,e);return!0},stopWorkers:function(){var a,r,t;for(a=r=0,t=this.workers.length-1;t>=0?t>=r:r>=t;a=t>=0?++r:--r)this.workers[a].terminate();return e("#loadDiv").toggle()}},e("#cancelButton").click(function(){return j.stopWorkers()}),D=function(a){var r,n,l,i,o,c,p;if(B=Date.now(),a)return e("#loadDiv").toggle(),n=parseInt(e("#numberOfWorkers").val(),10),j.startWorkers(n);for(l=new Tracer(z),i=c=0;N>=c;i=c+=1)for(o=p=0;m>=p;o=p+=1)r=l.colorFor(t.rayFor(N,m,i,o)),f.data[4*(i+(m-o-1)*N)+0]=255*r.r,f.data[4*(i+(m-o-1)*N)+1]=255*r.g,f.data[4*(i+(m-o-1)*N)+2]=255*r.b;return s.putImageData(f,0,0),e("#timeDiv").html("Rendered in "+(Date.now()-B)/1e3+" Seconds")},d=function(e,a,r,t,n){var l,i,o,c;for(c=[],l=o=a;t>=o;l=o+=1)c.push(function(){var a,t;for(t=[],i=a=r;n>=a;i=a+=1)f.data[4*(l+(m-i-1)*N)+0]=e[4*(l+(m-i-1)*N)+0],f.data[4*(l+(m-i-1)*N)+1]=e[4*(l+(m-i-1)*N)+1],t.push(f.data[4*(l+(m-i-1)*N)+2]=e[4*(l+(m-i-1)*N)+2]);return t}());return c},e("#goButton").click(function(){return M(),D(e("#webworkers")[0].checked)})})}).call(this);